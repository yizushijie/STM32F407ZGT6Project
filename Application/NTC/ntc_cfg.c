#include "ntc_cfg.h"

//===NTC电阻随温度变化对应的adc值
const unsigned int g_NTCTableADC[NTC_ADC_TABLE_MAX_SIZE] =
{
	NTC_SMP_ADC(190.5562),		//---/-40
	NTC_SMP_ADC(183.4132),
	NTC_SMP_ADC(175.6740),
	NTC_SMP_ADC(167.6467),
	NTC_SMP_ADC(159.5647),
	NTC_SMP_ADC(151.5975),
	NTC_SMP_ADC(143.8624),
	NTC_SMP_ADC(136.4361),
	NTC_SMP_ADC(129.3641),
	NTC_SMP_ADC(122.6678),
	NTC_SMP_ADC(116.3519),
	NTC_SMP_ADC(110.4098),
	NTC_SMP_ADC(104.8272),
	NTC_SMP_ADC(99.5847),
	NTC_SMP_ADC(94.6608),
	NTC_SMP_ADC(90.0326),
	NTC_SMP_ADC(85.6778),
	NTC_SMP_ADC(81.5747),
	NTC_SMP_ADC(77.7031),
	NTC_SMP_ADC(74.0442),
	NTC_SMP_ADC(70.5811),
	NTC_SMP_ADC(67.2987),
	NTC_SMP_ADC(64.1834),
	NTC_SMP_ADC(61.2233),
	NTC_SMP_ADC(58.4080),
	NTC_SMP_ADC(55.7284),
	NTC_SMP_ADC(53.1766),
	NTC_SMP_ADC(50.7456),
	NTC_SMP_ADC(48.4294),
	NTC_SMP_ADC(46.2224),
	NTC_SMP_ADC(44.1201),
	NTC_SMP_ADC(42.1180),
	NTC_SMP_ADC(40.2121),
	NTC_SMP_ADC(38.3988),
	NTC_SMP_ADC(36.6746),
	NTC_SMP_ADC(35.0362),
	NTC_SMP_ADC(33.4802),
	NTC_SMP_ADC(32.0035),
	NTC_SMP_ADC(30.6028),
	NTC_SMP_ADC(29.2750),
	NTC_SMP_ADC(28.0170),
	NTC_SMP_ADC(26.8255),
	NTC_SMP_ADC(25.6972),
	NTC_SMP_ADC(24.6290),
	NTC_SMP_ADC(23.6176),
	NTC_SMP_ADC(22.6597),
	NTC_SMP_ADC(21.7522),
	NTC_SMP_ADC(20.8916),
	NTC_SMP_ADC(20.0749),
	NTC_SMP_ADC(19.2988),
	NTC_SMP_ADC(18.5600),
	NTC_SMP_ADC(18.4818),
	NTC_SMP_ADC(18.1489),
	NTC_SMP_ADC(17.6316),
	NTC_SMP_ADC(16.9917),
	NTC_SMP_ADC(16.2797),
	NTC_SMP_ADC(15.5350),
	NTC_SMP_ADC(14.7867),
	NTC_SMP_ADC(14.0551),
	NTC_SMP_ADC(13.3536),
	NTC_SMP_ADC(12.6900),
	NTC_SMP_ADC(12.0684),
	NTC_SMP_ADC(11.4900),
	NTC_SMP_ADC(10.9539),
	NTC_SMP_ADC(10.4582),
	NTC_SMP_ADC(10.0000),
	NTC_SMP_ADC(9.5762),
	NTC_SMP_ADC(9.1835),
	NTC_SMP_ADC(8.8186),
	NTC_SMP_ADC(8.4784),
	NTC_SMP_ADC(8.1600),
	NTC_SMP_ADC(7.8608),
	NTC_SMP_ADC(7.5785),
	NTC_SMP_ADC(7.3109),
	NTC_SMP_ADC(7.0564),
	NTC_SMP_ADC(6.8133),
	NTC_SMP_ADC(6.5806),
	NTC_SMP_ADC(6.3570),
	NTC_SMP_ADC(6.1418),
	NTC_SMP_ADC(5.9343),
	NTC_SMP_ADC(5.7340),
	NTC_SMP_ADC(5.5405),
	NTC_SMP_ADC(5.3534),
	NTC_SMP_ADC(5.1725),
	NTC_SMP_ADC(4.9976),
	NTC_SMP_ADC(4.8286),
	NTC_SMP_ADC(4.6652),
	NTC_SMP_ADC(4.5073),
	NTC_SMP_ADC(4.3548),
	NTC_SMP_ADC(4.2075),
	NTC_SMP_ADC(4.0650),
	NTC_SMP_ADC(3.9271),
	NTC_SMP_ADC(3.7936),
	NTC_SMP_ADC(3.6639),
	NTC_SMP_ADC(3.5377),
	NTC_SMP_ADC(3.4146),
	NTC_SMP_ADC(3.2939),
	NTC_SMP_ADC(3.1752),
	NTC_SMP_ADC(3.0579),
	NTC_SMP_ADC(2.9414),
	NTC_SMP_ADC(2.8250),
	NTC_SMP_ADC(2.7762),
	NTC_SMP_ADC(2.7179),
	NTC_SMP_ADC(2.6523),
	NTC_SMP_ADC(2.5817),
	NTC_SMP_ADC(2.5076),
	NTC_SMP_ADC(2.4319),
	NTC_SMP_ADC(2.3557),
	NTC_SMP_ADC(2.2803),
	NTC_SMP_ADC(2.2065),
	NTC_SMP_ADC(2.1350),
	NTC_SMP_ADC(2.0661),
	NTC_SMP_ADC(2.0004),
	NTC_SMP_ADC(1.9378),
	NTC_SMP_ADC(1.8785),
	NTC_SMP_ADC(1.8225),
	NTC_SMP_ADC(1.7696),
	NTC_SMP_ADC(1.7197),
	NTC_SMP_ADC(1.6727),
	NTC_SMP_ADC(1.6282),
	NTC_SMP_ADC(1.5860),
	NTC_SMP_ADC(1.5458),
	NTC_SMP_ADC(1.5075),
	NTC_SMP_ADC(1.4707),
	NTC_SMP_ADC(1.4352),
	NTC_SMP_ADC(1.4006),
	NTC_SMP_ADC(1.3669),
	NTC_SMP_ADC(1.3337),
	NTC_SMP_ADC(1.3009),
	NTC_SMP_ADC(1.2684),
	NTC_SMP_ADC(1.2360),
	NTC_SMP_ADC(1.2037),
	NTC_SMP_ADC(1.1714),
	NTC_SMP_ADC(1.1390),
	NTC_SMP_ADC(1.1067),
	NTC_SMP_ADC(1.0744),
	NTC_SMP_ADC(1.0422),
	NTC_SMP_ADC(1.0104),
	NTC_SMP_ADC(0.9789),
	NTC_SMP_ADC(0.9481),
	NTC_SMP_ADC(0.9180),
	NTC_SMP_ADC(0.8889),
	NTC_SMP_ADC(0.8610),
	NTC_SMP_ADC(0.8346),
	NTC_SMP_ADC(0.8099),
	NTC_SMP_ADC(0.7870),
	NTC_SMP_ADC(0.7665),
	NTC_SMP_ADC(0.7485),
	NTC_SMP_ADC(0.7334),
	NTC_SMP_ADC(0.7214),
	NTC_SMP_ADC(0.7130),		//---110
};

///////////////////////////////////////////////////////////////////////////////
//////函		数：
//////功		能：NTC 温度计算,输入当前ADC电压值 0.1du,ADC值随温度上升而上升
//////输入参数:
//////输出参数:
//////说		明：
//////////////////////////////////////////////////////////////////////////////
INT16_T NTC_GetTemp(UINT16_T adcVal)
{
	UINT16_T i;
	INT16_T tp;
	adcVal += 70;
	#ifdef NTC_TO_VCC
		for (i = 0; i < NTC_ADC_TABLE_MAX_SIZE; i++)
		{
			if (adcVal < g_NTCTableADC[i])
			{
				break;
			}
		}
		if (i == 0)
		{
			tp = -1000;//最低温度
		}
		else if (i == NTC_ADC_TABLE_MAX_SIZE)
		{
			tp = 2500;//最高温度
		}
		else
		{
			tp = (adcVal - g_NTCTableADC[i - 1]) * 10 / (g_NTCTableADC[i] - g_NTCTableADC[i - 1]) + (i - 40 - 1) * 10;
		}
	#else
		for (i = 0; i < NTC_ADC_TABLE_MAX_SIZE; i++)
		{
			if (adcVal > g_NTCTableADC[i])
			{
				break;
			}
		}
		if (i == 0)
		{
			tp = -1000;//最低温度
		}
		else if (i == NTC_ADC_TABLE_MAX_SIZE)
		{
			tp = 1200;//最高温度
		}
		else
		{
			tp = (g_NTCTableADC[i - 1] - adcVal) * 10 / (g_NTCTableADC[i - 1] - g_NTCTableADC[i]) + (i - 40 - 1) * 10;
		}
	#endif
	return tp;
}